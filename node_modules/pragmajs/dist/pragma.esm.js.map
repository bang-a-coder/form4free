{"version":3,"file":"pragma.esm.js","sources":["../src/core/util/log.js","../src/core/actionChain.js","../src/core/util/utilities.js","../src/core/util/dom.js","../src/core/util/parsers.js","../src/core/util/index.js","../src/core/util/tpl.js","../src/core/element.js","../src/core/node.js","../src/core/pragma.js","../src/core/util/thread.js","../src/index.js"],"sourcesContent":["import { _deving } from \"./index\"\n\nexport function throwSoft (desc, potential=null, fixes=['rerun the code 10 times'], trigger=null, force=false) {\n  if (!_deving() && !force) return null\n  console.error(`%c ðŸ§¯ pragma.js  %c \\n\n      encountered a soft error ðŸ”« %c \\n\n      \\n${trigger ? `Triggered by: [${trigger.key} ${trigger}]` :``}\n      \\n${desc} %c\\n\n      \\n${ potential!=null ? `Potential ${potential}: \\n\\t${fixes.join(\"\\n\\t\")}` : '' }\n      `, \"font-size:15px\", \"font-size: 12px;\", \"color:whitesmoke\", \"color:white\")\n}\n\nexport function log(){\n  if (!_deving()) return null\n  console.log(...arguments)\n}\n\nexport function suc(){\n  if (!_deving()) return null\n  console.log(`%c ðŸŒ´ [pragma] \\n\n      `, \"font-size:12px; color:#86D787;\", ...arguments, \"\\n\")\n}\n","export default class ActionChain {\n  constructor(self){\n    this.self = self\n    this.actions = new Map()\n\n    //API extension\n    this.delete = this.destroy\n  }\n\n  addWithKey(cb, key=null){\n    key = key || this.actions.size\n    this.actions.set(key, cb)\n    return key\n  }\n\n  add(...cbs){\n    let keys = []\n    for (let cb of cbs){\n      keys.push(this.addWithKey(cb))\n    }\n\n    return keys.length > 1 ? keys : keys[0]\n  }\n\n  forAction(cb){\n    for (let [key, action] of this.actions) {\n      cb(key, action)\n    }\n  }\n\n  exec(...args){\n    this.execAs(this.self, ...args)\n  }\n\n  destroy(...keys){\n    keys.forEach(k => this.actions.delete(k))\n  }\n\n  execAs(self, ...args){\n    this.forAction((key, act) => {\n      let retVal = null\n\n      if (typeof act.bind === 'function'){\n        retVal = act.bind(self)(...args)\n      } else {\n        retVal = act(...args)\n      }\n\n      if (typeof retVal === 'function'){\n        // TODO make this a class\n        \n        let self = {\n          key: key,\n          action: act,\n          replaceWith: cb => {\n            // TODO implement\n          },\n          selfDestruct: () => {\n            this.destroy(key) \n          }\n        }\n\n        retVal(self)\n      }\n    })\n  }\n}\n","import ActionChain from \"../actionChain\"\nimport { _e } from \"../../index\"\n\nfunction rk5(){\n return Math.random().toString(36).substring(3, 6) + Math.random().toString(36).substring(5, 8)\n}\nfunction rk8(){ return rk(8)}\n\nfunction rk(l=7) {\n if (l < 5) return rk5()\n return (rk5() + rk(l-5)).substring(0, l)\n}\n\nfunction generateRandomKey(l){\n  return rk(l)\n}\n\nfunction aryDiff(a, b){\n  return a.filter(i => b.indexOf(i)<0)\n}\n\nfunction bench(cb, name){\n  console.time(name)\n  cb()\n  console.timeEnd(name)\n}\n\nfunction objDiff(obj, edit){\n  // TODO add recursive feature\n  for (let [key, value] of Object.entries(edit)){\n    obj[key] = value\n  }\n\n  return obj\n}\n\nconst snake2camel = str => str.replace(/([-_]\\w)/g, g => g[1].toUpperCase()) \n\nfunction _extend(e, proto){\n  Object.setPrototypeOf(e, objDiff(Object.getPrototypeOf(e), proto))\n}\n\nfunction mimic(obj, mimic, props){\n  for (let prop of (props || Object.keys(mimic))){\n    let desc = Object.getOwnPropertyDescriptor(mimic, prop) \n    if (!desc) break\n    Object.defineProperty(obj, prop, desc)\n  }\n}\n\nString.prototype.capitalize = function() {\n  return this.charAt(0).toUpperCase() + this.slice(1)\n}\n\nfunction _newChain(name, obj){\n  let chainName = `${name}Chain`\n  let eventName = `on${name.capitalize()}`\n\n  obj[chainName] = new ActionChain(obj)\n\n  obj[eventName] = function (cb, key) {\n    obj[chainName].addWithKey(cb, key)\n  }\n\n  return {\n      chainName: chainName,\n      eventName: eventName\n  }\n}\n\nfunction createChains(obj, ...chains){\n  for (let chain of chains){\n      _newChain(chain, obj)\n  }\n}\n\nfunction _newEventChain(name, obj){\n  let refs = _newChain(name, obj)\n  let done = `is${name.capitalize()}ed`\n\n  obj[refs.chainName].add(() => {\n    obj[done] = true\n  })\n\n  obj[refs.eventName] = function (cb) {\n    if (obj[done]) return cb(obj)\n    obj[refs.chainName].add(cb)\n  }\n}\n\n// DEPRECATE\nfunction createEventChains(obj, ...chains){\n  for (let chain of chains){\n      _newEventChain(chain, obj)\n  }\n}\n\nfunction addStyles(css, name=`injected-pragma-style`){\n  _e(`style#${name}-${rk5()}`, css).appendTo('head')\n}\n\nfunction overwrite(object, attr, over){\n  let superf = object[attr]\n  object[`_${attr}`] = superf.bind(object)\n  object[attr] = over\n}\n\nexport {\n  generateRandomKey,\n  objDiff,\n  aryDiff,\n  _extend,\n  overwrite,\n  createEventChains,\n  createChains,\n  snake2camel,\n  mimic,\n  bench,\n  addStyles,\n  rk, rk5, rk8\n}\n","import { throwSoft, suc } from \"./log\"\nimport { createEventChains } from \"./utilities\"\nimport _e from \"../element\"\n\nconst toHTMLAttr = s => s.toString().replace(/[^a-z0-9]/gi, '-').toLowerCase()\n\nif (!globalThis.pragmaSpace) globalThis.pragmaSpace = {} // initialize Pragma Space # TODO put this somewhere else\ncreateEventChains(globalThis.pragmaSpace, \"docLoad\")\nconst whenDOM = globalThis.pragmaSpace.onDocLoad\n\nfunction _docLoad(){\n  if (globalThis.pragmaSpace.isDocLoaded) return\n\n  suc(\"ðŸ“° document is loaded.\")\n  globalThis.pragmaSpace.docLoadChain.exec()\n}\ndocument.addEventListener('readystatechange', () => {\n  if (document.readyState === \"complete\") _docLoad()\n})\n\ndocument.addEventListener('turbolinks:load', () => {\n  suc(\"ðŸš€ TURBOLINKS loaded\")\n  _docLoad()\n})\n\nvar search = /[#.]/g\n\n// Create a hast element from a simple CSS selector.\nfunction parseQuery(selector, defaultTagName = \"div\") {\n  var value = selector || ''\n  var props = {\n    tag: defaultTagName\n  }\n  var start = 0\n  let subvalue, previous, match\n\n  while (start < value.length) {\n    search.lastIndex = start\n    match = search.exec(value)\n    subvalue = value.slice(start, match ? match.index : value.length)\n    if (subvalue) {\n      if (!previous) {\n        props.tag = subvalue\n      } else if (previous === '#') {\n        props.id = subvalue\n      } else if (props.class) {\n        props.class.push(subvalue)\n      } else {\n        props.class = [subvalue]\n      }\n      start += subvalue.length\n    }\n    if (match) {\n      previous = match[0]\n      start++\n    }\n  }\n  return props\n}\n\nfunction loopThruClassAryAndDo(cary, el, action){\n  if (!(Array.isArray(cary))) return throwSoft(`Could not ${action} class [${cary}] -> [${el}]`)\n  for (let c of cary){\n    let _subary = c.split(\" \")\n    if (_subary.length>1) {\n      loopThruClassAryAndDo(_subary, el, action)\n      //loopThruClassAryTo(_subary, el)\n      continue\n    }\n    el.classList[action](c)\n  }\n}\n\nfunction addClassAryTo(cary, el){ loopThruClassAryAndDo(cary, el, 'add') }\nfunction removeClassAryFrom(cary, el){ loopThruClassAryAndDo(cary, el, 'remove') }\nfunction toggleClassAryOf(cary, el){ loopThruClassAryAndDo(cary, el, 'toggle') }\n\nfunction selectOrCreateDOM(query){\n  try {\n    let e = document.querySelector(query)\n    if (e) return e\n  } catch {}\n\n  let q = parseQuery(query)\n\n  let el =  document.createElement(q.tag || \"div\")\n  if (q.id) el.id = q.id\n  if (q.class) addClassAryTo(q.class, el)\n\n  return el\n}\n\nfunction fragmentFromString(strHTML) {\n    return document.createRange().createContextualFragment(strHTML);\n}\n\nfunction elementFrom(e){\n  if (e instanceof Element) return e\n  if (typeof e === \"string\"){\n    if (e[0] === \"<\") return fragmentFromString(e)\n    return selectOrCreateDOM(e)\n  }\n\n  return throwSoft(`Could not find/create element from [${e}]`)\n}\n\nfunction fillSVG(svg, color){\n  _e(svg).findAll(\"path\").forEach(path => {\n    const ff = path.attr(\"fill\")\n    if (ff!=\"none\" && ff!=\"transparent\"){\n      path.attr(\"fill\", color)\n    }\n  })\n}\n\nexport {\n  whenDOM,\n  parseQuery,\n  addClassAryTo,\n  removeClassAryFrom,\n  toggleClassAryOf,\n  selectOrCreateDOM,\n  elementFrom,\n  toHTMLAttr,\n  fragmentFromString,\n  fillSVG\n}\n","import { throwSoft } from \"./log\"\nimport { snake2camel } from \"./utilities\"\n\n\nconst apply = {\n  html: ((html, dom) => {\n    dom.innerHTML = html \n  }),\n\n  pcss: ((pcss, dom) => {\n    for (let [key, value] of parse.cssToDict(pcss)){\n      dom.style[snake2camel(key)] = value \n    }\n  })\n}\n\nconst parse = {\n  cssToDict: ((str) => {\n    str = str.replace(/\\n/g, \";\").replace(/:/g, \" \")\n    let cssDict = new Map()\n    for (let style of str.split(\";\")) {\n      if (style.replace(/\\s/g, \"\").length < 2) continue\n      style = style.trim().split(\" \")\n      let key = style[0]\n      style.shift()\n      cssDict.set(key.trim(), style.join(\" \").trim())\n    }\n\n    // check css properties\n    let unsupported = []\n    for (const [key, value] of cssDict.entries()) {\n      if (!CSS.supports(key, value)) unsupported.push(`${key.trim()}: ${value.trim()}`)\n    }\n\n    if (unsupported.length > 0) {\n      throwSoft(`CSS syntax error`, 'typos', unsupported)\n    }\n    return cssDict\n  }),\n\n  css: ((pcss) => {\n    let css = \"\"\n    for (let [key, value] of parse.cssToDict(pcss)) {\n      //console.log(key, value)\n      css += `${key}:${value};`\n    }\n    return css\n  }),\n\n  html: ((html) => {\n    return html\n  })\n}\n\nexport {\n  parse,\n  apply\n}\n","if (!globalThis.pragmaSpace) globalThis.pragmaSpace = {} // initialize Pragma Space # TODO put this somewhere else\nglobalThis.pragmaSpace.dev =  globalThis.pragmaSpace.dev\n    || (typeof process !== \"undefined\" && process.env && process.env.NODE_ENV === 'development')\n\nexport function _deving(){\n  return globalThis.pragmaSpace.dev\n}\n\nexport * from \"./log\"\nexport * from \"./dom\"\nexport * from \"./utilities\"\nexport * from \"./parsers\"\nexport * from \"./tpl\"","import { Pragma, util } from \"../../index\"\n\nconst createTemplate = conf => new Pragma()\n    .run(function () {\n        util.createChains(this, 'config')\n\n        this.config = function(conf){\n            this.configChain.exec(conf)\n            return this\n        }\n        \n        this.onConfig((conf = {}) => {\n            const defaults = ['events', 'chains', 'exports', 'persistentExports']\n            defaults.forEach(attr => {\n                if (!conf[attr]) return\n                this[`_${attr}`] = conf[attr]\n                delete conf[attr]\n            })\n\n            if (this._events) util.createEventChains(this, ...(this._events))\n            if (this._chains) util.createChains(this, ...(this._chains))\n            \n            for (let [attr, val] of Object.entries(conf)) {\n                this[attr] = val\n                this.export(attr)\n            }\n            if (this._exports) this.export(...(this._exports))\n\n        })\n\n        this.export('exports', 'config', 'exportChain', 'configChain', 'onConfig')\n        \n    }, function () {\n        if (typeof conf === 'object') this.config(conf)\n    })\n\n\nexport { createTemplate }\n","// Its like $(\"#id\") of jquery\n\nimport {\n  throwSoft,\n  whenDOM,\n  addClassAryTo,\n  removeClassAryFrom,\n  toggleClassAryOf,\n  elementFrom,\n  apply,\n  createEventChains\n} from \"./util/index\"\n\n\nfunction domify(e){\n  if (e == null || e == undefined) return throwSoft(`Could not find a DOM element for ${e}`)\n  if (e.element) return domify(e.element)\n  let a = elementFrom(e)\n  return a\n}\n\n// function elementify(e){\n//   if (e == null) return document.body\n//   if (e.isPragmaElement === true) return e\n//   return new Element(e)\n// }\n\nfunction convertShadowToLight(e){\n  var l = document.createElement('template')\n  l.appendChild(e.cloneNode(true))\n  return l.firstChild\n}\n\nexport default function _e(query, innerHTML){\n    let element = domify(query)\n\n    if (element.constructor === DocumentFragment){\n      element = convertShadowToLight(element)\n    }\n\n    if (element instanceof Element){\n      element.init()\n      element._render()\n    }\n\n    if (typeof innerHTML === \"string\") element.html(innerHTML)\n    //if (typeof cb === \"function\") cb(element)\n    return element\n  //})\n}\n\nconst elementProto = {\n  init: function(){\n    this.isPragmaElement = true\n    //this.eventChains(\"docLoad\", \"render\")\n    createEventChains(this, \"docLoad\", \"render\")\n    whenDOM(() => this.docLoadChain.exec(this))\n  },\n\n  _render: function(){\n    this.renderChain.exec(this)\n  },\n\n  appendTo: function(where){\n    this.onDocLoad(() => {\n      this._parentElement = domify(where)\n      this._parentElement.appendChild(this)\n      this._render()\n    })\n    return this\n  },\n\n  prependTo: function(where){\n    this.onDocLoad(() => {\n      this._parentElement = domify(where)\n      this._parentElement.prepend(this)\n      this._render()\n    })\n    return this\n  },\n\n  append: function(...elements){\n    this.onRender(() => {\n      for (let e of elements){\n        let d = domify(e)\n        this.appendChild(d)  \n      }\n    })\n    return this\n  },\n\n  destroy: function(){\n    this.onRender(()=> {\n      // console.log(`destroy ${this}`, this)\n      if (this.parentElement) this.parentElement.removeChild(this)\n    })\n  },\n\n  css: function(styles){\n    this.onRender(() => {\n      apply.pcss(styles, this)\n    })\n    return this\n  },\n\n  setText: function(text){\n    if (!text) return this.text\n    this.onRender(() => {\n      this.textContent = text \n    })\n    return this\n  },\n  html: function(inner){\n    if (!inner) return this.innerHTML\n    this.onRender(() => {\n      apply.html(inner, this)\n    })\n    return this\n  },\n\n  setId: function(id){\n    this.id = id\n    return this\n  },\n\n  setData: function(obj){\n    for (let [key, val] of Object.entries(obj)){\n      this.dataset[key] = val\n    }\n    return this\n  },\n\n  getData: function(key){\n    return this.dataset[key] \n  },\n\n  addClass: function(...classes){\n    addClassAryTo(classes, this)\n    return this\n  },\n\n  removeClass: function(...classes){\n    removeClassAryFrom(classes, this)\n    return this\n  },\n\n  toggleClass: function(...classes){\n    toggleClassAryOf(classes, this) \n    return this\n  },\n\n  listenTo: function(...args){\n    this.onRender(() => {\n      this.addEventListener(...args)\n    })\n    return this\n  },\n\n  attr: function(a, val=undefined){\n    if (typeof a === 'string'){\n      if (val === undefined) return this.getAttribute(a)\n      const key = a\n      a = {}\n      a[key] = val\n    }\n\n    for (let [attr, val] of Object.entries(a)){\n      this.setAttribute(attr, val)\n    }\n\n    return this\n  },\n\n  find: function(){\n    return _e(this.query(...arguments))\n  },\n\n  findAll: function(query){\n    return Array.from(this.queryAll(query)).map(c => _e(c))\n  },\n\n  query: function(){\n    return this.querySelector(...arguments)\n  },\n\n  queryAll: function(query){\n    return this.querySelectorAll(query)\n  },\n  \n  hide: function(){\n    this.style.display = 'none'\n    return this\n  },\n  \n  show: function(){\n    this.style.display = ''\n    return this\n  },\n\n// DEPRECATE\n  deepQueryAll: function(query){\n    let hits = Array.from(this.queryAll(query))\n    for (let child of this.children){\n      hits = hits.concat(child.deepQueryAll(query))\n    }\n    return hits\n  },\n// DEPRECATE\n  deepFindAll: function(query){\n    return this.deepQueryAll(query).map(c => _e(c))\n  },\n\n  rect: function rect(){\n    return typeof this.getBoundingClientRect === \"function\" ?\n            this.getBoundingClientRect() : {}\n  },\n\n  offset: function offset(obj){\n\n    if (obj){\n      const cssAttrs = [ 'width', 'height', 'left', 'right', 'top', 'bottom']\n      cssAttrs.forEach(attr => {\n        if (attr in obj) this.style[attr] = obj[attr] + 'px'\n      })\n    }\n\n    var rect = this.rect()\n    return {\n      top: rect.top + window.scrollY,\n      left: rect.left + window.scrollX\n    }\n  },\n\n  x: function(relative_width){\n    return this.left + this.width/2 - relative_width/2\n  }\n}\n\nconst elementGetters = {\n  top:  function(){\n    return this.offset().top\n  },\n  left: function(){\n    return this.offset().left\n  },\n  width: function(){\n    return this.rect().width\n  },\n  height: function(){\n    return this.rect().height\n  },\n  text: function(){\n    return this.textContent\n  },\n  classArray: function(){\n    return Array.from(this.classList)\n  },\n  childrenArray: function(){\n    return Array.from(this.children)\n  }\n}\n\nfor (let [key, val] of Object.entries(elementProto)){\n  Element.prototype[key] = val\n}\n\nfor (let [key, val] of Object.entries(elementGetters)){\n  Object.defineProperty(Element.prototype, key, {\n    get: val,\n    configurable: true\n  })\n}\n\n// extend element instead of this weird ass thing\n","// recursively connected with other nodes\nimport { throwSoft, rk8, rk5 } from \"./util/index\"\n\nexport default class Node {\n  constructor(key) {\n    this._childMap = new Map()\n    this.key = typeof key === 'string' ? key : rk8()\n    // API\n    this.containsKey = this.childMap.has\n  }\n  set childMap(n){\n    for (let [key, child] of n){\n      if (child instanceof Node){\n        this.add(child)\n      }\n    }\n  }\n  get childMap(){\n    return this._childMap\n  }\n\n  get kidsum() { return this.childMap.size }\n  get hasKids() { return this.kidsum > 0 }\n  get shape() { return this.shapePrefix() }\n\n  get master() {\n    if (this.parent == null || this.parent.parent == null) return this.parent\n    return this.parent.master\n  }\n\n  get children() {\n    return Array.from(this.childMap.values())\n  }\n\n  get depthKey() {\n    if (this.parent) {\n      return this.parent.depthKey + \"<~<\" + this.key\n    }\n    return this.key\n  }\n\n  get allChildren() {\n    if (!this.hasKids) return null\n    let childs = this.children\n    for (let child of childs) {\n      let descs = child.allChildren\n      if (descs) childs = childs.concat(descs)\n    }\n    return childs\n  }\n\n  get(key){\n    return this.childMap.get(key)\n  }\n\n  find(key) {\n    // key = key.toString()\n    // recursively find a key\n    // return false\n    // console.log('trying to find', key)\n    // console.log(this.childMap)\n    if (this.childMap.has(key)) return this.childMap.get(key)\n    for (let value of this.childMap.values()) {\n      let v\n      try { v = value.find(key) } catch {} // if the value \n        // is typeof element and key is not valid selector..\n      if (v) return v\n    }\n  }\n\n  adopt(...children){\n      for (let child of children){\n        this.add(child)\n      }\n      return this\n  }\n\n  add(node, replace=false) {\n    if (!node) return throwSoft(`Could not add [${node}] to [${this.id}]`)\n    if (!replace && this.childMap.has(node.key)) {\n      node.key = `${node.key}<${rk5()}`\n      return this.add(node)\n    }\n    node.parent = this\n    this.childMap.set(node.key, node)\n    // this.children.push(spragma)\n  }\n\n  delete(key){return this.remove(key)}\n  remove(key){\n    let node = this.childMap.get(key)\n    if (node) this.childMap.delete(key)\n  }\n\n  shapePrefix(prefix = \"\") {\n    let shape = `${prefix}| ${this.type} - ${this.key} \\n`\n    if (this.hasKids) {\n      prefix += \"| \"\n      for (let child of this.children) {\n        shape += child.shapePrefix(prefix)\n      }\n    }\n    return shape\n  }\n}\n","import Node from \"./node\"\nimport _e from \"./element\"\nimport ActionChain from \"./actionChain\"\nimport { generateRandomKey, toHTMLAttr, createEventChains, suc, log, throwSoft } from \"./util/index\"\nimport { util } from \"..\"\n\n// DEPRECATE\nconst _parseMap = {\n\n  parent: (self, parent) => {\n    self.parent = parent\n  },\n\n  value: (self, v) => {\n    self.value = v\n  },\n\n  key: (self, key) => {\n    self.key = key\n  },\n\n  class: (self, className) => {\n    self._class = className\n  },\n\n  element: (self, element) => {\n    if (!(element instanceof Element)) return throwSoft(`Could not add ${element} as the element of [${self}]`)\n    self.element = element\n  },\n\n  children: (self, children) => {\n    if (children.constructor == Array) return self.buildAry(children)\n    self.build(children)\n  },\n\n  childTemplate: (self, temp) => {\n\n  }\n}\n\nfunction parseMap(map, obj) {\n  let _notParsed = new Map()\n\n  for (let [key, val] of Object.entries(map)){\n    if (_parseMap.hasOwnProperty(key)){\n      _parseMap[key](obj, val)\n      continue\n    }\n    _notParsed.set(key, val)\n  }\n\n  // add listener callbacks\n  if (obj.element) {\n    obj.element.whenInDOM((self) => {\n      for (let [key, val] of _notParsed) {\n        key = key.toLowerCase()\n        if (key.includes(\"on\")){\n          let event = key.split(\"on\")[1].trim()\n          self.listenTo(event, () => {\n            obj.action(val)\n          })\n        }\n      }\n    })\n  }\n}\n\n\nfunction _isRangeBounded(range){\n  return range && range.min != undefined && range.max != undefined\n}\nfunction _retValObj(val, set){\n  return {\n    val: val,\n    set: set\n  }\n}\nfunction _rangeBoundVal(v, range){\n  v = range.min ? Math.max(range.min, v) : v\n  v = range.max ? Math.min(range.max, v) : v\n  // console.log(v)\n  return v\n  // r ? Math.max(r[0], Math.min(v, r[1])) : v\n}\n\nfunction _loopBoundVal(v, range){\n  if (!(_isRangeBounded(range)))\n    return throwSoft(`Could not loop value, since range (${JSON.stringify(range)}) is unbounded`)\n\n  if (v == undefined) v = range.min\n\n  v = v > range.max ? range.min : v\n  v = v < range.min ? range.max : v\n  return v\n}\n\nfunction _processValue2(v, range, loop) {\n  if (loop) return _retValObj(_loopBoundVal(v, loop), true)\n  if (range) {\n    let r = _rangeBoundVal(v, range)\n    return _retValObj(r, r===v)\n  }\n\n  return _retValObj(v, true)\n}\n\nfunction _processValue(v, range, _loop) {\n  if (!range) return _retValObj(v, true)\n  if (_loop) return _retValObj(_loopBoundVal(v, range), true)\n  let r = _rangeBoundVal(v, range)\n  return _retValObj(r, r==v)\n}\n\nexport default class Pragma extends Node {\n  constructor(map, parent){\n    super()\n    createEventChains(this, 'export')\n\n    this.actionChain = new ActionChain()\n    this._events = new Map()\n\n    // console.log(\"-------------\")\n    if (typeof map === \"object\"){\n      parseMap(map, this)\n    } else {\n      this.key = map\n    }\n\n    if (!this.element) this.as()\n  }\n\n  listenTo(event, action){\n    this.element.listenTo(event, action.bind(this))\n    return this\n  }\n\n  _addToEventChain(name, ...cbs){\n    let chain = this._events.get(name)\n    if (chain){\n      let keys = chain.add(...cbs)\n      this._events.set(name, chain)\n      return keys\n    }\n\n    return null\n  }\n\n  createEvent(eventTitle, ...cbs){\n    let actions = new ActionChain(this)\n    this._events.set(eventTitle, actions)\n    if (cbs.length > 0) this.on(eventTitle, cbs)\n   \n    return this\n  }\n\n  createEvents(...events){\n    events.forEach(event => {\n      this.createEvent(event)\n    })\n\n    return this\n  }\n\n  triggerEvents(eventAry, ...args){\n    eventAry.forEach(event => {\n      this.triggerEvent(event, ...args)\n    })\n    return this\n  }\n\n  triggerEvent(eventName, ...args){\n    if (!this._events.has(eventName)) return util.throwSoft(`pragma doesnt have ${event} - cannot .triggerEvent(\"${event}\")]`, this)\n    this._events.get(eventName).execAs(this, ...args)\n\n    return this \n  }\n\n  _on(event, ...cbs){\n    let keys = this._addToEventChain(event, ...cbs)\n    if (keys === null) return util.throwSoft(`pragma doesnt have ${event} - cannot .on(\"${event}\")`, this)\n    return keys\n  }\n\n  on(){\n    this._on(...arguments)\n    return this\n  }\n\n  _onNext(event, cb){\n    let cbOnce = function(){\n      cb(...arguments) \n      return thisCallback => {\n        thisCallback.selfDestruct() \n      }\n    }\n\n    let key = this._on(event, cbOnce)\n  }\n\n  onNext(){\n    this._onNext(...arguments)\n       return this\n  }\n\n  createWires(...wireNames) { wireNames.forEach(wire => this.createWire(wire) ); return this }\n  createWire(wireName){\n\n    let events = {\n      change: `${wireName}Change`,\n      set: `${wireName}Set`\n    }\n\n    this.createEvents(events.change, events.set)\n\n\n    Object.defineProperty(this, wireName, {\n      set: newValue => {\n        let pv = _processValue2(newValue, this[`_${wireName}Range`], this[`_${wireName}Loop`])\n        const oldValue = this[`_${wireName}`]\n        if (pv.set && (pv.val !== oldValue)) {\n          this[`_${wireName}`] = pv.val\n          this.triggerEvent(events.change, pv.val, oldValue)\n        }\n\n        this.triggerEvent(events.set, newValue, oldValue)\n      },\n      get: () => {\n        return this[`_${wireName}`]\n      }\n    })\n\n    this[`set${wireName.capitalize()}`] = value => {\n      this[`${wireName}`] = value\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Silently`] = value => {\n      this[`_${wireName}`] = value\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Loop`] = (min, max) => {\n      this[`_${wireName}Loop`] = { min: min, max: max }\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Range`] = (min, max) => {\n      this[`_${wireName}Range`] = { min: min, max: max }\n      return this\n    }\n\n    return this\n  }\n\n  get _e(){ return this.element }\n  setElement(e, inheritId=true){\n    this.elementDOM = e\n    if (inheritId && this.element.id){\n      this.id = this.element.id\n    }\n\n    return this\n  }\n\n  get element(){ return this.elementDOM }\n  set element(n) {\n    this.setElement(n)\n    // TODO check if element is of type elememtn blah blha\n    // log(\">> SETTING THIS DOM ELEMENT\", n, this.id)\n\n\n    // this.id = this.element.id || this.id\n  }\n\n// -------------------- VALUE THINGS\n\n  setRange(min=null, max=null){\n    this.range = this.range || {}\n    this.range.min = min === null ? this.range.min : min\n    this.range.max = max === null ? this.range.max : max\n    return this\n  }\n\n  breakLoop() { this._loopVal = false; return this }\n  setLoop(min, max){\n    this.setRange(min, max)\n    this._loopVal = true\n    return this\n  }\n\n  get dv(){\n    return this.v - this._lv\n  }\n  get value(){\n    return this.v\n  }\n\n  setValue(n) { this.value = n; return this }\n\n  set value(n) {\n    let pv = _processValue(n, this.range, this._loopVal)\n\n    if (pv.set) {\n      this._lv = this.v\n      this.v = pv.val\n      this.exec()\n    }\n  }\n\n\n//  -------------------------------\n\n  exec() {\n    this.actionChain.execAs(this, ...arguments)\n    return this\n  }\n\n  setKey(key) { this.key = key; return this }\n  set key(key){\n    // console.log('setting key to ', key)\n    this._KEY = key == null ? generateRandomKey() : key\n  }\n\n  get key() { return this._KEY }\n\n  set id(n) {\n    // console.log('setting key to from id ', n)\n    // this.key = n\n    if (this.element) this.element.id = this.id\n  }\n\n  get id() {\n    return toHTMLAttr(this.key)\n  }\n\n  buildAry(aryOfMaps){\n    for (let map of aryOfMaps){\n      this.add(new Pragma(map, this))\n    }\n    return this\n  }\n\n  build(...maps) {\n    return this.buildAry(maps)\n  }\n\n  // FOR HTML DOM\n  as(query=null, innerHTML){\n    query = query || `div#${this.id}.pragma`\n    // this.element = _e(query, innerHTML)\n    this.setElement(_e(query, innerHTML), false)\n    return this\n  }\n\n  // FOR TEMPLATES\n  addExport(exp){\n    this.exports = this.exports || new Set()\n    this.exports.add(exp)\n  }\n\n  export(...attrs){\n    for (let a of attrs) {\n      this.addExport(a)\n    }\n  }\n\n  import(...pragmas){\n    let exportChain = new ActionChain()\n\n    for (let pragma of pragmas){\n      if (typeof pragma === 'function'){\n        pragma = pragma()\n      }\n      \n      if (pragma.exports){\n        // if ('exportChain' in pragma.exports)\n        util.mimic(this, pragma, pragma.exports)\n      }\n\n      if (pragma.exportChain){\n        exportChain.add(_ => {\n          pragma.exportChain.exec(this)\n        })  \n      }\n    }\n    \n    exportChain.exec()\n    return this\n  }\n\n  // TODO DEPRECATE\n  from(pragma){\n    if (pragma.exports){\n      util.mimic(this, pragma, pragma.exports)\n      //for (let attr of pragma.exports){\n        //// this[attr] = pragma[attr]\n        //let desc = Object.getOwnPropertyDescriptor(pragma, attr) \n        //if (!desc) break\n\n        //Object.defineProperty(this, attr, desc)\n      //}\n    }\n\n    if (pragma.exportChain) pragma.exportChain.exec(this)\n    return this\n  }\n\n  wireTo(pragma){\n    let self = this\n    pragma.do(function(){\n      // console.log(this)\n      // console.log(p.value)\n      // this.value = pragma.value\n      self.value = this.value\n    })\n    return this\n  }\n\n  // ADD SCRIPT TO RUN WHEN VALUE CHANGES\n  do(){\n    this.actionChain.add(...arguments)\n    return this\n  }\n\n\n  // EXTEND\n  extend(attr, newer){\n    util.overwrite(this, attr, newer)\n    return this\n  }\n\n  // RUN SCRIPTS WITH THIS SCOPE\n\n\n  run(...scripts){\n    let sample = scripts[0]\n    if (typeof sample === 'function'){\n      this._runAry(scripts)\n    } else if (typeof sample === 'object'){\n      this._runAry(Object.values(sample))\n    } else {\n      throwSoft(`Could not run [${scripts}] as [${this}]`)\n    }\n    return this\n  }\n\n  _runAry(scripts){\n    for (let script of scripts){\n      this.runAs(script)\n    }\n  }\n\n  runAs(script){\n    return script.bind(this)()\n  }\n  \n  containAry(childs, action='append'){\n    for (let child of childs) {\n      super.add(child)\n\n      if (child.isRendered){\n        throwSoft(`[${child}] is already appended`)\n      }else{\n        this.element[action](child)\n      }\n      \n    }\n    return this\n  }\n\n  contain(...childs){\n    return this.containAry(childs)\n  }\n\n  containFirst(...childs){\n    // TODO FIX \n    return this.containAry(childs.reverse(), 'prepend')\n  }\n\n  pragmatize(){\n    this.element.appendTo(this.parent ? this.parent.element || \"body\" : \"body\")\n    return this\n  }\n\n  pragmatizeAt(query){\n    this.element.appendTo(query)\n    return this\n  }\n\n  addListeners(listeners){\n    for (let [ev, action] of Object.entries(listeners)){\n      this.on(ev).do(action)\n    }\n    return this\n  }\n}\n\n\nconst _hostElementAttrs = [\n  \"html\",\n  \"css\",\n  \"addClass\",\n  \"removeClass\",\n  \"toggleClass\",\n  \"setId\",\n  'append',\n  'prepend',\n  'appendTo',\n  'prependTo',\n  'setData'\n]\n\nfor (let a of _hostElementAttrs) {\n Pragma.prototype[a] = function() {\n    this.element[a](...arguments)\n    return this\n  }\n}\n\nconst _adoptElementAttrs = [\n  'getData'\n]\n\nfor (let a of _adoptElementAttrs) {\n Pragma.prototype[a] = function() {\n    return this.element[a](...arguments)\n  }\n}\n\nconst _adoptGetters = [\n  // html things\n  // \"text\",\n  \"offset\", \"text\",\n  'top', 'left', 'width', 'height', 'x',\n  'classArray'\n]\n\nfor (let a of _adoptGetters) {\n  Object.defineProperty(Pragma.prototype, a, {\n    get: function() {\n      return this.element[a]\n    }\n  })\n}\n\n\n// Mousetrap integration TODO improve this\nif (!globalThis.pragmaSpace) globalThis.pragmaSpace = {}\nglobalThis.pragmaSpace.integrateMousetrap = function(trap){\n  if (typeof trap === 'function') {\n   Pragma.prototype.bind = function(key, f, on=undefined){\n     let self = this\n      trap.bind(key, function(){\n        return self.runAs(f)\n      }, on)\n      return this\n   }\n\n   globalThis.pragmaSpace.mousetrapIntegration = true\n   suc('Mousetrap configuration detected! Extended Pragmas to support .bind() method!')\n }\n}\n\ntry {\n  globalThis.pragmaSpace.integrateMousetrap(Mousetrap)\n} catch (e) {\n  log(`Tried to integrate extensions, but failed. To disable,\n  this attempt: globalThis.pragmaSpace.integrate3rdParties = false`)\n}\n\n // Pragma.prototype[a] = function() {\n //    this.element[a](...arguments)\n //  }\n/*\n *pragmaMap = {\n *  id: \"\",\n *  class: \"\",\n *  value: 0,\n *  elements: [],\n *  element: \"\" / dom,\n *  onSet: () => {\n *\n *  },\n *  onClick: () => {\n *\n *  }\n *}\n */\n","export function _thread(cb) {\n  let code = `\n    onmessage = e => postMessage(JSON.stringify((${cb.toString()})(e.data))) \n  `  \n  var blob = new Blob([code], {\n    type: \"application/javascript\"\n  })\n\n  var worker = new Worker(URL.createObjectURL(blob))\n\n  return function(){\n      worker.postMessage(arguments)\n    return new Promise(resolve=> {\n      worker.addEventListener('message', m => resolve(JSON.parse(m.data)))\n    })\n  }\n}\n\n/*\n *\n usage:\n \n     const threadedFunction = _thread(data => {\n        return 'your palms are ' + data\n     })\n \n    threadedFunction(\"sweaty\").then(d => console.log('heee', d))\n*/\n    \n\nexport function _runAsync(cb) {\n  return new Promise(r => r(cb()))\n}\n\nexport function runAsync(...cbs) {\n  return _runAsync(() => {\n    for (let cb of cbs) {\n        _runAsync(cb)\n    }\n  })\n}\n","import _e from \"./core/element\"\nimport Pragma from \"./core/pragma\"\nimport ActionChain from \"./core/actionChain\"\n\nexport { _e, Pragma, ActionChain }\n\n// API layer\n\n//const Îµ = function() {\n  //return new Element(...arguments)\n//}\n\nconst Ï€ = (query, opt) => new Pragma(query, opt)\nconst _p = Ï€\n//const _e = Îµ\n\nexport { Ï€, _p }\n\nexport * as util from \"./core/util/index\"\n\nexport { _thread, runAsync, _runAsync } from \"./core/util/thread\"\n\nconst exported = [ '_e', '_p', 'Pragma', 'util', '_thread' ]\n\nexport function globalify() {\n  let pragmaModule = (globalThis || window)[\"pragma\"]\n  if (pragmaModule !== \"undefined\" && pragmaModule.__esModule) {\n    for (let func of exported) {\n      globalThis[func] = pragmaModule[func]\n    }\n  } else {\n    console.error(\"Could not globalify [pragma]\")\n  }\n}\n\nexport function render(location){\n  window.location.href = location \n}\n"],"names":["throwSoft","desc","potential","fixes","trigger","force","_deving","console","error","key","join","log","arguments","suc","ActionChain","[object Object]","self","this","actions","Map","delete","destroy","cb","size","set","cbs","keys","push","addWithKey","length","action","args","execAs","forEach","k","forAction","act","retVal","bind","replaceWith","selfDestruct","rk5","Math","random","toString","substring","rk8","rk","l","generateRandomKey","objDiff","obj","edit","value","Object","entries","snake2camel","str","replace","g","toUpperCase","_newChain","name","chainName","eventName","capitalize","createChains","chains","chain","_newEventChain","refs","done","add","createEventChains","String","prototype","charAt","slice","toHTMLAttr","s","toLowerCase","globalThis","pragmaSpace","whenDOM","onDocLoad","_docLoad","isDocLoaded","docLoadChain","exec","document","addEventListener","readyState","search","parseQuery","selector","defaultTagName","props","tag","start","subvalue","previous","match","lastIndex","index","id","class","loopThruClassAryAndDo","cary","el","Array","isArray","c","_subary","split","classList","addClassAryTo","removeClassAryFrom","toggleClassAryOf","selectOrCreateDOM","query","e","querySelector","q","createElement","fragmentFromString","strHTML","createRange","createContextualFragment","elementFrom","Element","apply","html","dom","innerHTML","pcss","parse","cssToDict","style","cssDict","trim","shift","unsupported","CSS","supports","css","dev","process","env","NODE_ENV","svg","color","_e","findAll","path","ff","attr","a","b","filter","i","indexOf","proto","setPrototypeOf","getPrototypeOf","object","over","superf","mimic","prop","getOwnPropertyDescriptor","defineProperty","time","timeEnd","appendTo","conf","Pragma","run","util.createChains","config","configChain","onConfig","_events","util.createEventChains","_chains","val","export","_exports","domify","undefined","element","constructor","DocumentFragment","appendChild","cloneNode","firstChild","init","_render","elementProto","isPragmaElement","renderChain","where","_parentElement","prependTo","prepend","append","elements","onRender","d","parentElement","removeChild","styles","setText","text","textContent","inner","setId","setData","dataset","getData","addClass","classes","removeClass","toggleClass","listenTo","getAttribute","setAttribute","find","from","queryAll","map","querySelectorAll","hide","display","show","deepQueryAll","hits","child","children","concat","deepFindAll","rect","getBoundingClientRect","offset","top","window","scrollY","left","scrollX","x","relative_width","width","elementGetters","height","classArray","childrenArray","get","configurable","Node","_childMap","containsKey","childMap","has","n","kidsum","hasKids","shape","shapePrefix","master","parent","values","depthKey","allChildren","childs","descs","v","node","remove","prefix","type","_parseMap","className","_class","buildAry","build","childTemplate","temp","_retValObj","_rangeBoundVal","range","min","max","_loopBoundVal","JSON","stringify","super","actionChain","_notParsed","hasOwnProperty","whenInDOM","includes","event","parseMap","as","eventTitle","on","events","createEvent","eventAry","triggerEvent","util","_addToEventChain","_on","thisCallback","_onNext","wireNames","wire","createWire","wireName","change","createEvents","newValue","pv","loop","r","_processValue2","oldValue","inheritId","elementDOM","setElement","_loopVal","setRange","dv","_lv","_loop","_processValue","_KEY","aryOfMaps","maps","exp","exports","Set","attrs","addExport","pragmas","exportChain","pragma","_","do","newer","overwrite","scripts","sample","_runAry","script","runAs","isRendered","containAry","reverse","listeners","ev","_hostElementAttrs","_adoptElementAttrs","_adoptGetters","integrateMousetrap","trap","f","mousetrapIntegration","Mousetrap","_thread","code","blob","Blob","worker","Worker","URL","createObjectURL","postMessage","Promise","resolve","m","data","_runAsync","runAsync","Ï€","opt","_p","exported","globalify","pragmaModule","__esModule","func","render","location","href"],"mappings":"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"}